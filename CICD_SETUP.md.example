# üöÄ CI/CD Setup Guide - TEMPLATE

> ‚ö†Ô∏è **C·∫¢NH B√ÅO**: ƒê√¢y l√† file TEMPLATE. File `CICD_SETUP.md` th·ª±c t·∫ø ch·ª©a credentials kh√¥ng ƒë∆∞·ª£c commit v√†o Git!

## üìã GitHub Secrets Configuration

ƒê·ªÉ CI/CD ho·∫°t ƒë·ªông, b·∫°n c·∫ßn th√™m c√°c secrets sau v√†o GitHub Repository Settings ‚Üí Secrets and variables ‚Üí Actions:

### Backend Services Secrets

| Secret Name | Value | Description |
|------------|-------|-------------|
| `DB_PASSWORD` | `<your-main-db-password>` | M·∫≠t kh·∫©u DB ch√≠nh (user,order,payment,product) |
| `SPRING_DATASOURCE_PASSWORD` | `<your-main-db-password>` | M·∫≠t kh·∫©u datasource ch√≠nh |
| `NOTIFICATION_DB_PASSWORD` | `<your-notification-db-password>` | M·∫≠t kh·∫©u DB notification service |
| `FILE_DB_PASSWORD` | `<your-file-db-password>` | M·∫≠t kh·∫©u DB file service |
| `RABBITMQ_ADDRESSES` | `amqps://<user>:<pass>@<host>/<vhost>` | RabbitMQ connection string |
| `RABBITMQ_USERNAME` | `<your-rabbitmq-username>` | RabbitMQ username |
| `RABBITMQ_PASSWORD` | `<your-rabbitmq-password>` | M·∫≠t kh·∫©u RabbitMQ |
| `RABBITMQ_VIRTUAL_HOST` | `<your-vhost>` | RabbitMQ vhost |
| `REDIS_HOST` | `<your-redis-host>` | Redis host |
| `REDIS_PORT` | `25061` | Redis port |
| `REDIS_USERNAME` | `default` | Redis username |
| `REDIS_PASSWORD` | `<your-redis-password>` | Redis password |
| `JWT_SIGNER_KEY` | `<generate-strong-key>` | JWT signing key |
| `INTERNAL_SERVICE_SECRET` | `<generate-strong-key>` | Internal service auth key |

### S3/DigitalOcean Spaces

| Secret Name | Value | Description |
|------------|-------|-------------|
| `S3_ENDPOINT` | `https://<region>.digitaloceanspaces.com` | S3 endpoint |
| `S3_REGION` | `<region>` | S3 region |
| `S3_BUCKET_NAME` | `<bucket-name>` | S3 bucket name |
| `S3_ACCESS_KEY` | `<your-access-key>` | S3 access key |
| `S3_SECRET_KEY` | `<your-secret-key>` | S3 secret key |

### Google OAuth

| Secret Name | Value | Description |
|------------|-------|-------------|
| `GOOGLE_CLIENT_ID` | `<your-client-id>.apps.googleusercontent.com` | Google OAuth Client ID |
| `GOOGLE_CLIENT_SECRET` | `<your-client-secret>` | Google OAuth Client Secret |

### Payment Gateway (ZaloPay)

| Secret Name | Value | Description |
|------------|-------|-------------|
| `ZALOPAY_APP_ID` | `<your-app-id>` | ZaloPay App ID |
| `ZALOPAY_KEY1` | `<your-key1>` | ZaloPay Key 1 |
| `ZALOPAY_KEY2` | `<your-key2>` | ZaloPay Key 2 |
| `ZALOPAY_CREATE_ORDER_URL` | `https://sb-openapi.zalopay.vn/v2/create` | Create order endpoint |
| `ZALOPAY_QUERY_ORDER_URL` | `https://sb-openapi.zalopay.vn/v2/query` | Query order endpoint |
| `ZALOPAY_GET_BANK_LIST_URL` | `https://sbgateway.zalopay.vn/api/getlistmerchantbanks` | Bank list endpoint |
| `ZALOPAY_CALLBACK_URL` | `http://<your-server>/api/payment/v1/payments/zalopay/callback` | Callback URL |
| `ZALOPAY_REDIRECT_URL` | `http://<your-frontend>/payment/result` | Redirect URL |

### Frontend Secrets

| Secret Name | Value | Description |
|------------|-------|-------------|
| `VITE_BACKEND_URL` | (empty for production) | Backend API URL |
| `VITE_WS_URL` | (empty for production) | WebSocket URL |

### Deployment Secrets

| Secret Name | Value | Description |
|------------|-------|-------------|
| `SSH_HOST` | `<your-server-ip>` | Server IP address |
| `SSH_USERNAME` | `<your-username>` | SSH username |
| `SSH_PRIVATE_KEY` | `<private-key-content>` | SSH private key |
| `SSH_PORT` | `22` | SSH port |

---

## üîÑ Deployment Workflow

### Backend Deployment

```mermaid
graph LR
    A[Push Tag dev_*] --> B[Build Services]
    B --> C[Build Docker Images]
    C --> D[Push to GHCR]
    D --> E[SSH to Server]
    E --> F[Create .env]
    F --> G[Docker Compose Up]
    G --> H[Health Check]
```

**Trigger:**
```bash
git tag dev_18.12.2025_v1
git push origin dev_18.12.2025_v1
```

### Frontend Deployment

```mermaid
graph LR
    A[Push Tag fe_dev_*] --> B[Build React App]
    B --> C[Build Docker Image]
    C --> D[Push to GHCR]
    D --> E[SSH to Server]
    E --> F[Docker Compose Up]
    F --> G[Health Check]
```

**Trigger:**
```bash
git tag fe_dev_18.12.2025_v1
git push origin fe_dev_18.12.2025_v1
```

---

## üîê Security Checklist

- [ ] T·∫•t c·∫£ GitHub Secrets ƒë√£ ƒë∆∞·ª£c th√™m
- [ ] File `.env` kh√¥ng ƒë∆∞·ª£c commit (ki·ªÉm tra `.gitignore`)
- [ ] File `SECURITY.md` kh√¥ng ƒë∆∞·ª£c commit
- [ ] File `CICD_SETUP.md` kh√¥ng ƒë∆∞·ª£c commit
- [ ] SSH private key ch·ªâ s·ª≠ d·ª•ng cho deployment
- [ ] Credentials ƒë∆∞·ª£c rotate ƒë·ªãnh k·ª≥
- [ ] 2FA ƒë√£ b·∫≠t cho GitHub account
- [ ] Server firewall ƒë√£ c·∫•u h√¨nh ƒë√∫ng

---

## üÜò Troubleshooting

### Deployment Failed

1. Ki·ªÉm tra GitHub Actions logs
2. Verify t·∫•t c·∫£ Secrets ƒë√£ ƒë∆∞·ª£c th√™m ƒë√∫ng
3. Ki·ªÉm tra SSH connection
4. Verify Docker images ƒë√£ ƒë∆∞·ª£c push

### Health Check Failed

1. Ki·ªÉm tra service logs: `docker logs <service-name>`
2. Verify environment variables
3. Ki·ªÉm tra database connection
4. Ki·ªÉm tra port conflicts

### Cannot Connect to Services

1. Verify service ƒëang ch·∫°y: `docker ps`
2. Ki·ªÉm tra network: `docker network ls`
3. Verify firewall rules
4. Ki·ªÉm tra DNS configuration

---

**L∆∞u √Ω:** File n√†y ch·ªâ l√† template. File `CICD_SETUP.md` th·ª±c t·∫ø ch·ª©a credentials KH√îNG ƒë∆∞·ª£c commit v√†o Git!
