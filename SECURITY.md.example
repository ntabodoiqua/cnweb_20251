# üîê H∆∞·ªõng d·∫´n B·∫£o m·∫≠t & C·∫•u h√¨nh Secrets

> ‚ö†Ô∏è **C·∫¢NH B√ÅO**: File n√†y l√† TEMPLATE. Kh√¥ng bao gi·ªù commit file `SECURITY.md` th·ª±c t·∫ø ch·ª©a credentials v√†o Git!

## üìã T·ªïng quan

File n√†y h∆∞·ªõng d·∫´n c√°ch c·∫•u h√¨nh GitHub Secrets v√† environment variables ƒë·ªÉ deploy ·ª©ng d·ª•ng m·ªôt c√°ch an to√†n.

---

## üö® Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu

### 1. Ki·ªÉm tra .gitignore

ƒê·∫£m b·∫£o c√°c file sau **KH√îNG BAO GI·ªú** ƒë∆∞·ª£c commit:

```
.env
.env.*
!.env.example
SECURITY.md
CICD_SETUP.md
```

### 2. N·∫øu ƒë√£ commit nh·∫ßm credentials

```bash
# X√≥a kh·ªèi Git index (gi·ªØ l·∫°i file local)
git rm --cached .env SECURITY.md

# X√≥a ho√†n to√†n kh·ªèi Git history
git filter-branch --force --index-filter \
  'git rm --cached --ignore-unmatch .env SECURITY.md CICD_SETUP.md' \
  --prune-empty --tag-name-filter cat -- --all

# D·ªçn d·∫πp repository
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# Force push (c·∫©n th·∫≠n!)
git push --force
```

### 3. ƒê·ªïi t·∫•t c·∫£ m·∫≠t kh·∫©u ƒë√£ b·ªã l·ªô

‚ö†Ô∏è **QUAN TR·ªåNG**: ƒê·ªïi ngay t·∫•t c·∫£ m·∫≠t kh·∫©u ƒë√£ t·ª´ng commit l√™n Git, bao g·ªìm:

- Database passwords
- API keys
- JWT secret keys
- S3/Object storage credentials
- Payment gateway keys
- Email credentials
- OAuth credentials

---

## üîë C·∫•u h√¨nh GitHub Secrets

### Truy c·∫≠p GitHub Secrets

1. V√†o repository tr√™n GitHub
2. Ch·ªçn **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. Click **New repository secret**

### Danh s√°ch Secrets c·∫ßn th√™m

#### Database Configuration

```
DB_PASSWORD
Gi√° tr·ªã: <your-database-password>
M√¥ t·∫£: M·∫≠t kh·∫©u cho database c·ªßa order_service, payment_service, product_service, user_service

NOTIFICATION_DB_PASSWORD
Gi√° tr·ªã: <your-notification-db-password>
M√¥ t·∫£: M·∫≠t kh·∫©u cho database c·ªßa notification_service (cluster ri√™ng)

FILE_DB_PASSWORD
Gi√° tr·ªã: <your-file-db-password>
M√¥ t·∫£: M·∫≠t kh·∫©u cho database c·ªßa file_service (cluster ri√™ng)
```

#### Redis Configuration

```
REDIS_HOST
Gi√° tr·ªã: <your-redis-host>

REDIS_PORT
Gi√° tr·ªã: 25061

REDIS_USERNAME
Gi√° tr·ªã: default

REDIS_PASSWORD
Gi√° tr·ªã: <your-redis-password>
```

#### RabbitMQ Configuration

```
RABBITMQ_ADDRESSES
Gi√° tr·ªã: amqps://<username>:<password>@<host>/<vhost>

RABBITMQ_USERNAME
Gi√° tr·ªã: <your-rabbitmq-username>

RABBITMQ_PASSWORD
Gi√° tr·ªã: <your-rabbitmq-password>

RABBITMQ_VIRTUAL_HOST
Gi√° tr·ªã: <your-vhost>
```

#### JWT Configuration

```
JWT_SIGNER_KEY
Gi√° tr·ªã: <generate-strong-random-key>

INTERNAL_SERVICE_SECRET
Gi√° tr·ªã: <generate-strong-random-key>
```

#### S3/Object Storage (File Service)

```
S3_ENDPOINT
Gi√° tr·ªã: https://<region>.digitaloceanspaces.com

S3_REGION
Gi√° tr·ªã: <your-region>

S3_BUCKET_NAME
Gi√° tr·ªã: <your-bucket-name>

S3_ACCESS_KEY
Gi√° tr·ªã: <your-s3-access-key>

S3_SECRET_KEY
Gi√° tr·ªã: <your-s3-secret-key>
```

#### Google OAuth (User Service)

```
GOOGLE_CLIENT_ID
Gi√° tr·ªã: <your-google-client-id>.apps.googleusercontent.com

GOOGLE_CLIENT_SECRET
Gi√° tr·ªã: <your-google-client-secret>
```

#### Payment Gateway (ZaloPay)

```
ZALOPAY_APP_ID
Gi√° tr·ªã: <your-zalopay-app-id>

ZALOPAY_KEY1
Gi√° tr·ªã: <your-zalopay-key1>

ZALOPAY_KEY2
Gi√° tr·ªã: <your-zalopay-key2>

ZALOPAY_CREATE_ORDER_URL
Gi√° tr·ªã: https://sb-openapi.zalopay.vn/v2/create

ZALOPAY_QUERY_ORDER_URL
Gi√° tr·ªã: https://sb-openapi.zalopay.vn/v2/query

ZALOPAY_GET_BANK_LIST_URL
Gi√° tr·ªã: https://sbgateway.zalopay.vn/api/getlistmerchantbanks

ZALOPAY_CALLBACK_URL
Gi√° tr·ªã: http://your-server-ip:8080/api/payment/v1/payments/zalopay/callback

ZALOPAY_REDIRECT_URL
Gi√° tr·ªã: http://your-frontend-url/payment/result
```

#### SendGrid (Email Service)

```
SENDGRID_API_KEY
Gi√° tr·ªã: <your-sendgrid-api-key>
```

#### Payment Redirect

```
PAYMENT_REDIRECT_URL
Gi√° tr·ªã: https://your-domain.com/payment/result
```

#### Frontend Configuration

```
GOOGLE_CLIENT_ID
Gi√° tr·ªã: <your-google-client-id>.apps.googleusercontent.com
M√¥ t·∫£: Google OAuth Client ID (ƒë√£ ƒë·ªãnh nghƒ©a ·ªü ph·∫ßn Google OAuth ph√≠a tr√™n)
```

**L∆∞u √Ω quan tr·ªçng v·ªÅ VITE_BACKEND_URL v√† VITE_WS_URL:**
- C√°c bi·∫øn n√†y **KH√îNG C·∫¶N** th√™m v√†o GitHub Secrets
- Trong production, ƒë·ªÉ ch√∫ng R·ªñNG ƒë·ªÉ frontend t·ª± ƒë·ªông d√πng current host
- Frontend code ƒë√£ x·ª≠ l√Ω: n·∫øu empty ‚Üí d√πng relative URLs v√† current host
- Workflow ƒë√£ c·∫•u h√¨nh: `VITE_BACKEND_URL=` v√† `VITE_WS_URL=` (empty string)

#### Deployment Configuration

```
SSH_HOST
Gi√° tr·ªã: <your-server-ip>

SSH_USERNAME
Gi√° tr·ªã: <your-ssh-username>

SSH_PRIVATE_KEY
Gi√° tr·ªã: <n·ªôi-dung-private-key-ssh>

SSH_PORT
Gi√° tr·ªã: 22
```

---

## üìù C·∫•u h√¨nh Local Development

### T·∫°o file .env t·ª´ template

```bash
# Copy file template
cp .env.example .env

# Ch·ªânh s·ª≠a file .env v·ªõi th√¥ng tin th·ª±c t·∫ø
nano .env  # ho·∫∑c s·ª≠ d·ª•ng editor kh√°c
```

### C·∫≠p nh·∫≠t .env v·ªõi th√¥ng tin th·ª±c

```dotenv
# Database Configuration
SPRING_DATASOURCE_PASSWORD=<your-db-password>

# Redis Configuration
REDIS_HOST=<your-redis-host>
REDIS_PORT=25061
REDIS_USERNAME=default
REDIS_PASSWORD=<your-redis-password>

# ... (c√°c bi·∫øn kh√°c)
```

### Ch·∫°y ·ª©ng d·ª•ng local

```bash
# Backend services
cd backend
docker-compose up -d

# Frontend
cd frontend

# Copy .env.example v√† c·∫•u h√¨nh
cp .env.example .env.development

# Ch·ªânh s·ª≠a .env.development v·ªõi th√¥ng tin development
nano .env.development

# C√†i ƒë·∫∑t dependencies v√† ch·∫°y
npm install
npm run dev
```

---

## üöÄ CI/CD Pipeline

### Backend Deployment Workflow

**File:** `.github/workflows/deploy.yml`  
**Trigger:** Push tag v·ªõi pattern `dev_*` (v√≠ d·ª•: `dev_18.12.2025_v1`)

Workflow s·∫Ω t·ª± ƒë·ªông:

1. ‚úÖ Build Docker images cho t·∫•t c·∫£ 9 microservices
2. ‚úÖ Push images l√™n GitHub Container Registry (GHCR)
3. ‚úÖ SSH v√†o server v√† deploy
4. ‚úÖ Inject environment variables t·ª´ GitHub Secrets
5. ‚úÖ Health check t·∫•t c·∫£ services

**C√°ch trigger:**
```bash
git tag dev_18.12.2025_v1
git push origin dev_18.12.2025_v1
```

### Frontend Deployment Workflow

**File:** `.github/workflows/frontend-deploy.yaml`  
**Trigger:** Push tag v·ªõi pattern `fe_dev_*` (v√≠ d·ª•: `fe_dev_18.12.2025_v1`)

Workflow s·∫Ω t·ª± ƒë·ªông:

1. ‚úÖ Build React application v·ªõi environment variables t·ª´ GitHub Secrets
2. ‚úÖ T·∫°o Docker image ch·ª©a static files (Nginx)
3. ‚úÖ Push image l√™n GHCR
4. ‚úÖ SSH v√†o server v√† deploy
5. ‚úÖ Health check frontend endpoint

**C√°ch trigger:**
```bash
git tag fe_dev_18.12.2025_v1
git push origin fe_dev_18.12.2025_v1
```

### B·∫£o m·∫≠t trong CI/CD

- ‚úÖ **Kh√¥ng commit .env files** v√†o Git (ƒë√£ c√≥ trong .gitignore)
- ‚úÖ **Build-time injection:** Frontend nh·∫≠n environment variables qua Docker build arguments
- ‚úÖ **Runtime injection:** Backend nh·∫≠n environment variables khi container kh·ªüi ƒë·ªông
- ‚úÖ **Secrets t·ª´ GitHub:** T·∫•t c·∫£ th√¥ng tin nh·∫°y c·∫£m ƒë∆∞·ª£c l∆∞u trong GitHub Secrets
- ‚úÖ **No hardcoded credentials:** T·∫•t c·∫£ credentials ƒë·ªÅu d√πng ${VARIABLE} ho·∫∑c build args

---

## üîê Best Practices

### 1. Qu·∫£n l√Ω Secrets

- ‚úÖ Kh√¥ng bao gi·ªù commit credentials v√†o Git
- ‚úÖ S·ª≠ d·ª•ng GitHub Secrets cho CI/CD
- ‚úÖ S·ª≠ d·ª•ng environment variables trong code
- ‚úÖ Rotate credentials ƒë·ªãnh k·ª≥

### 2. Access Control

- ‚úÖ Gi·ªõi h·∫°n quy·ªÅn truy c·∫≠p GitHub Secrets
- ‚úÖ S·ª≠ d·ª•ng SSH keys ri√™ng cho deployment
- ‚úÖ Enable 2FA cho t·∫•t c·∫£ accounts quan tr·ªçng

### 3. Monitoring

- ‚úÖ Monitor deployment logs
- ‚úÖ Set up alerts cho failed deployments
- ‚úÖ Ki·ªÉm tra health checks sau m·ªói deployment

### 4. Backup

- ‚úÖ Backup credentials ·ªü n∆°i an to√†n (password manager)
- ‚úÖ Document recovery procedures
- ‚úÖ Test disaster recovery plan

---

## üìû Support

N·∫øu g·∫∑p v·∫•n ƒë·ªÅ v·ªÅ b·∫£o m·∫≠t ho·∫∑c c·∫ßn h·ªó tr·ª£ c·∫•u h√¨nh, vui l√≤ng li√™n h·ªá team.

---

**L∆∞u √Ω cu·ªëi c√πng:** File SECURITY.md th·ª±c t·∫ø ch·ª©a credentials **KH√îNG BAO GI·ªú** ƒë∆∞·ª£c commit v√†o Git. Ch·ªâ file template n√†y (.example) m·ªõi ƒë∆∞·ª£c commit.
